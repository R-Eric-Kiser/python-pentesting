import paramiko

# Prompt for server names and SSH username
servers = input("Enter server names (comma-separated): ").split(",")
username = input("Enter SSH username: ")

# Loop through each server and connect using SSH
for server in servers:
    print(f"Connecting to {server}...")
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    ssh.connect(server, username=username)

    # Execute command to list running services
    if "windows" in ssh.exec_command("echo %OS%")[1].read().decode().lower():
        # For Windows systems, use "sc query" command
        stdin, stdout, stderr = ssh.exec_command("sc query")
        services = [line.strip() for line in stdout.readlines()]
    else:
        # For Linux systems, use "systemctl" command
        stdin, stdout, stderr = ssh.exec_command("systemctl list-units --type=service --state=running")
        services = [line.strip() for line in stdout.readlines()]

    # Print list of running services
    print(f"Running services on {server}:")
    for service in services:
        print(service)

    # Close SSH connection
    ssh.close()
